---
- when: _irods_cfg_icat is mapping
  block:
    - name: validate database config params
      when: _irods_cfg_validate
      assert:
        that:
          - _irods_cfg_icat.catalog_database_type in ('mysql', 'oracle', 'postgres')
          - _irods_cfg_icat.db_port | int >= 1 and _irods_cfg_icat.db_port | int <= 65535

    - include_tasks: _cfg_template.yml
      vars:
        _cfg_template_dest_file: etc/irods/database_config.json

- meta: flush_handlers
