---
- name: test database_config notifies change
  hosts: localhost
  become: true
  pre_tasks:
    - set_fact:
        irods_cfg_made_changes: false

  tasks:
    - include_role:
        name: ../../ansible-irods-cfg
        tasks_from: database_config.yml
      vars:
        irods_cfg_icat: {}

  post_tasks:
    - include_tasks: tasks/verify_change_notified.yml


- name: test host_access_control_config file deposition individually
  hosts: localhost
  become: true
  pre_tasks:
    - set_fact:
        irods_cfg_made_changes: false

  tasks:
    - include_role:
        name: ../../ansible-irods-cfg
        tasks_from: host_access_control_config.yml
      vars:
        irods_cfg_access_entries:
          - address: localhost
            group:  group
            mask: mask
            user: user

  post_tasks:
    - include_tasks: tasks/verify_change_notified.yml


- name: test hosts_config notifies change
  hosts: localhost
  become: true
  pre_tasks:
    - set_fact:
        irods_cfg_made_changes: false

  tasks:
    - include_role:
        name: ../../ansible-irods-cfg
        tasks_from: hosts_config.yml
      vars:
        irods_cfg_host_entries:
          - address_type: local
            addresses:
              - address

  post_tasks:
    - include_tasks: tasks/verify_change_notified.yml


- name: test irods_environment notifies change
  hosts: localhost
  become: true
  pre_tasks:
    - set_fact:
        irods_cfg_made_changes: false

  tasks:
    - include_role:
        name: ../../ansible-irods-cfg
        tasks_from: irods_environment.yml
      vars:
        irods_cfg_authentication_file: /tmp

  post_tasks:
    - include_tasks: tasks/verify_change_notified.yml


- name: test server_config notifies change
  hosts: localhost
  become: true
  pre_tasks:
    - set_fact:
        irods_cfg_made_changes: false

  tasks:
    - include_role:
        name: ../../ansible-irods-cfg
        tasks_from: server_config.yml
      vars:
        irods_cfg_default_number_of_transfer_threads: 1

  post_tasks:
    - include_tasks: tasks/verify_change_notified.yml


- name: test service_account notifies change
  hosts: localhost
  become: true
  pre_tasks:
    - set_fact:
        irods_cfg_made_changes: false

  tasks:
    - include_role:
        name: ../../ansible-irods-cfg
        tasks_from: service_account.yml
      vars:
        irods_cfg_service_account_name: root

  post_tasks:
    - include_tasks: tasks/verify_change_notified.yml
